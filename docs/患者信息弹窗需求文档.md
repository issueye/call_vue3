# 患者信息弹窗 - 产品需求文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 功能名称 | 患者信息弹窗 |
| 需求版本 | v1.0.0 |
| 文档日期 | 2026-01-07 |
| 产品经理 | Claude |
| 开发工程师 | Frontend Vue Engineer |
| 优先级 | P1（高优先级） |

---

## 一、需求背景

### 1.1 业务场景

医生在工作台查看患者列表时，需要快速查看某个患者的完整信息，包括基本信息、就诊信息、状态等详细内容。目前的实现方式是在侧边栏显示患者详情卡片，但有以下问题：

- 桌面端：患者详情卡片占据固定空间，影响列表展示区域
- 移动端：详情卡片和列表上下排列，需要频繁滚动
- 列表项信息有限：无法在列表中展示完整患者信息

### 1.2 用户痛点

1. **信息获取不便**：列表项只显示部分信息，查看完整信息需要先选择患者
2. **空间占用**：详情卡片常驻界面，影响其他内容的展示
3. **操作效率低**：快速浏览多个患者信息时需要频繁切换当前患者

### 1.3 产品价值

**用户价值：**
- ✅ 快速查看任意患者的完整信息，无需先选中
- ✅ 弹窗模式不占用界面固定空间
- ✅ 提升信息获取效率，优化操作流程

**产品价值：**
- ✅ 完善患者信息展示能力
- ✅ 提升用户体验和操作效率
- ✅ 保持界面简洁，减少视觉干扰

---

## 二、功能需求

### 2.1 核心功能

**功能描述：**
在患者列表中为每个患者项添加"查看详情"操作，点击后以弹窗形式展示该患者的完整信息。

**功能范围：**
- 仅查看患者详细信息，不包含呼叫、过号、结诊等操作
- 支持从候诊、过号、结诊等所有状态的患者列表触发
- 支持桌面端和移动端显示

---

### 2.2 功能详情

#### 2.2.1 触发入口

**触发方式：**
1. **主触发器**：患者列表项右侧添加"详情"图标按钮
   - 桌面端：鼠标悬停时显示，点击打开弹窗
   - 移动端：常驻显示，点击打开弹窗

2. **备选触发器**：点击患者列表项主体（可配置）
   - 整个列表项可点击
   - 与"选择患者"操作区分（如双击选择、单击查看）

**UI 设计：**
```
┌─────────────────────────────────────────────┐
│  [排队号]  张三  男  35岁  [候诊中]     [详情]│
│  初诊  第3次呼叫  138****1234               │
└─────────────────────────────────────────────┘
```

---

#### 2.2.2 弹窗内容

**展示信息分类：**

##### A. 基本信息区

| 字段名 | 显示标签 | 数据来源 | 说明 |
|--------|----------|----------|------|
| queueNo | 排队号 | patient.queueNo | 显示编号 |
| name | 姓名 | patient.name | 患者姓名 |
| gender | 性别 | patient.gender | 1=男，非1=女 |
| age | 年龄 | patient.age | 数字 |
| phone | 联系电话 | patient.phone | 手机号 |

##### B. 就诊信息区

| 字段名 | 显示标签 | 数据来源 | 说明 |
|--------|----------|----------|------|
| visitType | 就诊类型 | patient.visitType | 1=初诊，非1=复诊 |
| line_num | 排队序号 | patient.line_num | 当前排队位置 |
| callTimes | 呼叫次数 | patient.callTimes | 累计呼叫次数 |
| state | 就诊状态 | patient.state | 状态标签 |

##### C. 状态标签

| state 值 | 显示文本 | 样式类名 |
|----------|----------|----------|
| 0 | 接诊中 | status-calling |
| 1 | 优先 | status-priority |
| 2 | 候诊中 | status-waiting |
| 3 | 复诊 | status-revisit |
| 4 | 过号 | status-passed |
| 99 | 结诊 | status-called |

---

#### 2.2.3 弹窗布局

**整体结构：**
```
┌────────────────────────────────────────┐
│          患者详情          [×]         │ ← 标题栏
├────────────────────────────────────────┤
│                                        │
│  ┌──────────────────────────────────┐  │
│  │       📋 基本信息                │  │ ← 分区标题
│  ├──────────────────────────────────┤  │
│  │  排队号:    A001                  │  │
│  │  姓名:      张三                  │  │
│  │  性别:      男                    │  │
│  │  年龄:      35岁                  │  │
│  │  联系电话:  138****1234           │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │       🏥 就诊信息                │  │ ← 分区标题
│  ├──────────────────────────────────┤  │
│  │  就诊类型:  初诊                  │  │
│  │  排队序号:  15                    │  │
│  │  呼叫次数:  3次                   │  │
│  │  就诊状态:  [候诊中]              │  │
│  └──────────────────────────────────┘  │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │       📅 时间信息                │  │ ← 分区标题（可选）
│  ├──────────────────────────────────┤  │
│  │  排队时间:  2026-01-07 09:30     │  │
│  │  就诊时间:  -                     │  │
│  └──────────────────────────────────┘  │
│                                        │
├────────────────────────────────────────┤
│                     [关闭]              │ ← 底部按钮
└────────────────────────────────────────┘
```

---

#### 2.2.4 弹窗特性

**尺寸规范：**
- 桌面端：宽度 480px，最大高度 80vh
- 移动端：宽度 90vw，最大高度 85vh

**交互行为：**
1. **打开方式**
   - 点击"详情"按钮打开
   - 带淡入动画（300ms）

2. **关闭方式**
   - 点击关闭按钮（×）
   - 点击底部"关闭"按钮
   - 点击遮罩层（可配置是否允许）
   - 按 ESC 键关闭

3. **动画效果**
   - 打开：淡入 + 缩放（从 0.95 到 1）
   - 关闭：淡出

4. **滚动支持**
   - 内容超出时弹窗内部滚动
   - 遮罩层固定不滚动

---

### 2.3 数据来源

**数据获取方式：**
- 直接使用患者列表中已有的患者数据
- 不需要额外的 API 请求
- 数据通过 props 传入弹窗组件

**数据格式：**
```javascript
const patient = {
  queueNo: "A001",
  name: "张三",
  gender: 1,
  age: 35,
  phone: "13800138000",
  visitType: 1,
  line_num: 15,
  callTimes: 3,
  state: 2,
  // ... 其他字段
}
```

---

### 2.4 状态管理

**弹窗状态：**
```javascript
// 在 patient store 中添加
const showDetailDialog = ref(false);  // 是否显示详情弹窗
const dialogPatient = ref(null);       // 弹窗展示的患者数据

// 打开详情弹窗
const openDetailDialog = (patient) => {
  dialogPatient.value = patient;
  showDetailDialog.value = true;
}

// 关闭详情弹窗
const closeDetailDialog = () => {
  showDetailDialog.value = false;
  dialogPatient.value = null;
}
```

---

### 2.5 响应式设计

**桌面端（≥ 768px）：**
- 弹窗宽度 480px
- 左右居中显示
- 双列布局（基本信息左右排列）

**移动端（< 768px）：**
- 弹窗宽度 90vw
- 底部对齐显示（类似 BottomSheet）
- 单列布局

---

## 三、非功能需求

### 3.1 性能要求

- 弹窗打开响应时间 < 100ms
- 动画帧率 ≥ 60fps
- 不影响列表滚动性能

### 3.2 兼容性要求

- 桌面端：Chrome 90+、Edge 90+、Firefox 88+
- 移动端：iOS Safari 14+、Android Chrome 90+

### 3.3 可访问性

- 支持键盘操作（ESC 关闭、Tab 聚焦）
- 支持屏幕阅读器
- 适当的焦点管理

---

## 四、UI/UX 设计规范

### 4.1 颜色方案

```css
/* 弹窗遮罩 */
--dialog-overlay-bg: rgba(0, 0, 0, 0.5);

/* 弹窗背景 */
--dialog-bg: #ffffff;

/* 分区标题 */
--section-title-bg: #f5f7fa;
--section-title-text: #303133;

/* 标签文本 */
--label-text: #606266;
--label-color: #909399;

/* 值文本 */
--value-text: #303133;

/* 状态标签 */
--status-waiting-bg: #ecf5ff;
--status-waiting-text: #409eff;
--status-passed-bg: #fef0f0;
--status-passed-text: #f56c6c;
--status-called-bg: #f0f9ff;
--status-called-text: #67c23a;
```

### 4.2 间距规范

```css
--dialog-padding: 24px;
--section-margin: 16px;
--field-height: 40px;
--button-height: 36px;
```

### 4.3 字体规范

```css
--title-font-size: 18px;
--section-title-font-size: 14px;
--content-font-size: 14px;
```

---

## 五、交互流程

### 5.1 正常流程

```
用户操作                    系统响应
   │                           │
   ├─── 点击"详情"按钮 ───────→ │ 1. 显示加载动画（可选）
   │                           │ 2. 打开弹窗（淡入动画）
   │                           │ 3. 展示患者信息
   │                           │
   ├─── 查看信息 ────────────→ │ （无操作，仅查看）
   │                           │
   ├─── 点击"关闭"按钮 ──────→ │ 1. 关闭弹窗（淡出动画）
   │                           │ 2. 清空患者数据
   │                           │
   └─── 返回列表 ────────────→ │ （列表状态不变）
```

### 5.2 异常处理

| 异常情况 | 处理方式 |
|----------|----------|
| 患者数据为空 | 显示"暂无患者信息"提示 |
| 关键字段缺失 | 显示"-"占位符 |
| 弹窗打开失败 | 显示错误提示，不阻塞列表操作 |

---

## 六、验收标准

### 6.1 功能验收

- [ ] 点击患者列表的"详情"按钮能打开弹窗
- [ ] 弹窗正确展示患者的基本信息和就诊信息
- [ ] 状态标签根据患者状态显示正确的颜色和文案
- [ ] 弹窗支持多种关闭方式（按钮、遮罩、ESC）
- [ ] 弹窗关闭后正确清空数据
- [ ] 从候诊、过号、结诊等列表都能打开详情弹窗

### 6.2 UI/UX 验收

- [ ] 弹窗尺寸符合设计规范
- [ ] 动画流畅自然，无明显卡顿
- [ ] 桌面端和移动端显示效果良好
- [ ] 信息层级清晰，易于阅读
- [ ] 颜色、间距、字体符合设计规范

### 6.3 性能验收

- [ ] 弹窗打开响应时间 < 100ms
- [ ] 列表滚动不受弹窗影响
- [ ] 无内存泄漏

---

## 七、技术实现要点

### 7.1 组件结构

```
PatientDetailDialog.vue  (新建)
├── template
│   ├── Teleport (挂载到 body)
│   └── 弹窗容器
│       ├── 标题栏
│       ├── 内容区（滚动）
│       │   ├── 基本信息区
│       │   ├── 就诊信息区
│       │   └── 时间信息区（可选）
│       └── 底部按钮区
├── script
│   ├── props 定义
│   ├── emits 定义
│   ├── 计算属性（性别、就诊类型转换）
│   └── 方法（关闭处理）
└── style
    ├── 响应式布局
    └── 动画效果
```

### 7.2 文件位置

```
frontend/src/components/common/PatientDetailDialog.vue  (新建)
frontend/src/stores/patient.js                          (修改：添加弹窗状态)
frontend/src/components/layout/desktop/PatientList.vue  (修改：添加详情按钮)
frontend/src/components/layout/mobile/PatientList.vue   (修改：添加详情按钮)
```

### 7.3 关键技术点

1. **使用 Teleport**：将弹窗挂载到 body，避免层级问题
2. **v-model 绑定**：支持 `v-model:visible` 双向绑定
3. **计算属性**：性别、就诊类型等字段的转换
4. **watch 监听**：监听 visible 变化，处理动画
5. **响应式设计**：使用媒体查询适配不同屏幕

---

## 八、后续优化方向

### 8.1 功能增强

- [ ] 支持在弹窗中直接进行呼叫、过号等操作
- [ ] 添加患者就诊历史记录
- [ ] 支持打印患者信息
- [ ] 添加患者备注功能

### 8.2 体验优化

- [ ] 添加手势关闭（移动端向下滑动）
- [ ] 记住弹窗位置
- [ ] 支持快捷键操作
- [ ] 添加骨架屏加载态

---

## 九、附录

### 9.1 参考文档

- [Element Plus Dialog 组件](https://element-plus.org/zh-CN/component/dialog.html)
- [现有患者详情卡片组件](../src/components/layout/desktop/PatientDetailCard.vue)
- [产品功能说明文档](./产品功能说明文档.md)

### 9.2 数据字段对照表

| 字段名 | 类型 | 说明 | 示例值 |
|--------|------|------|--------|
| queueNo | String | 排队号 | "A001" |
| name | String | 姓名 | "张三" |
| gender | Number | 性别 | 1（男） |
| age | Number | 年龄 | 35 |
| phone | String | 联系电话 | "13800138000" |
| visitType | Number | 就诊类型 | 1（初诊） |
| line_num | Number | 排队序号 | 15 |
| callTimes | Number | 呼叫次数 | 3 |
| state | Number | 就诊状态 | 2（候诊中） |

### 9.3 状态码说明

| state | 显示文本 | 样式类 | 颜色 |
|-------|----------|--------|------|
| 0 | 接诊中 | status-calling | 蓝色 |
| 1 | 优先 | status-priority | 橙色 |
| 2 | 候诊中 | status-waiting | 蓝色 |
| 3 | 复诊 | status-revisit | 绿色 |
| 4 | 过号 | status-passed | 红色 |
| 99 | 结诊 | status-called | 灰色 |

---

## 十、变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0.0 | 2026-01-07 | 产品经理 | 初始版本 |

---

**文档结束**
