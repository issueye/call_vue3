# 患者操作功能测试文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 患者操作功能测试指南 |
| 文档版本 | v1.0.0 |
| 测试日期 | 2026-01-07 |
| 测试范围 | 呼叫、重呼、下一位、过号、结诊、分诊 |

---

## 一、功能概览

### 1.1 已实现功能

| 功能 | 状态 | 组件/方法 | 说明 |
|------|------|----------|------|
| **呼叫患者** | ✅ 完成 | `callPatient()` | 呼叫排队队列第一位患者 |
| **重呼患者** | ✅ 新增 | `recallPatient()` | 重新呼叫当前在诊患者 |
| **下一位（智能）** | ✅ 优化 | `handleNext()` | 智能判断首次或分诊 |
| **过号** | ✅ 完成 | `skipPatient()` | 标记患者过号 |
| **结诊** | ✅ 完成 | `endPatient()` | 完成患者诊疗 |
| **分诊弹窗** | ✅ 新增 | `TriageDialog.vue` | 转诊或结诊选择 |
| **患者详情弹窗** | ✅ 完成 | `PatientDetailDialog.vue` | 查看患者详细信息 |

### 1.2 组件清单

| 组件 | 路径 | 说明 |
|------|------|------|
| 分诊弹窗 | `components/common/TriageDialog.vue` | 转诊/结诊选择弹窗 |
| 患者详情弹窗 | `components/common/PatientDetailDialog.vue` | 患者信息详情 |
| 呼叫按钮 | `components/layout/desktop/CallButtons.vue` | 桌面端呼叫按钮组 |
| 呼叫按钮 | `components/layout/mobile/CallButtons.vue` | 移动端呼叫按钮组 |
| 桌面端布局 | `components/layout/desktop/DesktopLayout.vue` | 桌面端主布局 |
| 移动端布局 | `components/layout/mobile/MobileLayout.vue` | 移动端主布局 |

---

## 二、功能测试指南

### 2.1 呼叫患者功能

#### 测试场景 1：首次呼叫

**前置条件：**
- 已登录系统
- 排队队列中有候诊患者
- 无当前在诊患者

**操作步骤：**
1. 进入工作台页面
2. 点击患者详情卡片中的"下一位"按钮
3. 或点击患者列表项的呼叫按钮

**预期结果：**
- ✅ 成功呼叫队列中第一位患者
- ✅ 显示患者信息（姓名、排队号、状态等）
- ✅ 患者状态变为"接诊中"（蓝色）
- ✅ 无需显示分诊弹窗（首次直接呼叫）

**验证点：**
- [ ] API 调用成功（`/lime/api/v1/ts/triage/patient/call`）
- [ ] 患者信息正确显示
- [ ] `visitPatient` 状态已更新
- [ ] `isFirstCall` 标记已设置为 `false`

---

#### 测试场景 2：重复呼叫

**前置条件：**
- 已有在诊患者
- 队列中有其他候诊患者

**操作步骤：**
1. 点击"下一位"按钮

**预期结果：**
- ✅ 显示分诊弹窗（因为有在诊患者）
- ✅ 弹窗中显示当前患者信息
- ✅ 提示选择处理方式（转诊或结诊）

**验证点：**
- [ ] 分诊弹窗正确显示
- [ ] 当前患者信息完整显示
- [ ] 可选诊室列表正确加载

---

### 2.2 重呼功能

#### 测试场景 1：重呼当前在诊患者

**前置条件：**
- 已有在诊患者

**操作步骤：**
1. 点击"重呼"按钮

**预期结果：**
- ✅ 成功重新呼叫当前患者
- ✅ 呼叫次数自动 +1
- ✅ 播放语音提示（如有）

**验证点：**
- [ ] API 调用成功，携带 `appointment_id`
- [ ] `call_count` 或 `callTimes` 字段正确更新
- [ ] 界面显示最新的呼叫次数

---

#### 测试场景 2：无患者时重呼

**前置条件：**
- 无当前在诊患者

**操作步骤：**
1. 点击"重呼"按钮

**预期结果：**
- ✅ 按钮禁用或显示提示"无在诊患者，无法重呼"
- ✅ 不调用 API

**验证点：**
- [ ] 按钮状态正确（禁用）
- [ ] 提示信息友好
- [ ] 无网络请求

---

### 2.3 下一位功能

#### 测试场景 1：首次进入（无在诊患者）

**前置条件：**
- 应用刚启动
- 无当前在诊患者
- 队列中有候诊患者

**操作步骤：**
1. 点击"下一位"按钮

**预期结果：**
- ✅ 直接呼叫第一位候诊患者
- ✅ 不显示分诊弹窗
- ✅ 更新在诊患者状态

**验证点：**
- [ ] `isFirstCall` 为 `true` 时直接呼叫
- [ ] `visitPatient` 正确更新
- [ ] `isFirstCall` 更新为 `false`

---

#### 测试场景 2：有在诊患者

**前置条件：**
- 已有在诊患者

**操作步骤：**
1. 点击"下一位"按钮

**预期结果：**
- ✅ 显示分诊弹窗
- ✅ 显示当前患者信息
- ✅ 加载可转诊诊室列表（如有）

**验证点：**
- [ ] 分诊弹窗正确显示
- [ ] 患者信息卡片显示完整
- [ ] 诊室列表正确加载（调用 `getDeptRoomList`）

---

### 2.4 过号功能

#### 测试场景 1：标记过号

**前置条件：**
- 已有在诊患者

**操作步骤：**
1. 点击"过号"按钮

**预期结果：**
- ✅ 患者状态变为"过号"（红色标签）
- ✅ 患者从"接诊中"列表移除
- ✅ 患者出现在"过号"标签下
- ✅ 清空当前在诊患者

**验证点：**
- [ ] API 调用成功（`/lime/api/v1/ts/triage/patient/pass`）
- [ ] 患者状态更新为 `4`（过号）
- [ ] 当前患者信息清空
- [ ] 列表正确刷新

---

### 2.5 结诊功能

#### 测试场景 1：通过分诊弹窗结诊

**前置条件：**
- 已有在诊患者
- 分诊弹窗已打开

**操作步骤：**
1. 点击分诊弹窗中的"完成诊疗"按钮
2. 在确认对话框中点击"确定"

**预期结果：**
- ✅ 患者状态变为"已结诊"（灰色标签）
- ✅ 患者出现在"结诊"标签下
- ✅ 分诊弹窗关闭
- ✅ 自动呼叫下一位患者
- ✅ 显示"结诊成功"提示

**验证点：**
- [ ] API 调用成功（`/lime/api/v1/ts/triage/patient/end`）
- [ ] 患者状态更新为 `99`（结诊）
- [ ] `visitPatient` 清空
- [ ] 自动触发下一位呼叫
- [ ] 成功提示显示

---

#### 测试场景 2：取消结诊

**前置条件：**
- 分诊弹窗已打开

**操作步骤：**
1. 点击"完成诊疗"按钮
2. 在确认对话框中点击"取消"

**预期结果：**
- ✅ 分诊弹窗保持打开
- ✅ 患者状态不变
- ✅ 无 API 调用

**验证点：**
- [ ] 弹窗状态正确
- [ ] 患者状态未改变
- [ ] 无网络请求

---

### 2.6 转诊功能

#### 测试场景 1：转诊到其他诊室

**前置条件：**
- 已有在诊患者
- 分诊弹窗已打开
- 有可用的其他诊室

**操作步骤：**
1. 在下拉框中选择目标诊室
2. 点击"确认转诊"按钮

**预期结果：**
- ✅ 患者从当前诊室列表中移除
- ✅ 分诊弹窗关闭
- ✅ 显示"转诊成功"提示
- ✅ 当前在诊患者清空

**验证点：**
- [ ] API 调用成功（`/lime/api/v1/ts/triage/patient/move`）
- [ ] 患者从列表中移除
- [ ] `visitPatient` 清空
- [ ] 分诊弹窗关闭

---

#### 测试场景 2：未选择诊室

**前置条件：**
- 分诊弹窗已打开

**操作步骤：**
1. 不选择诊室
2. 点击"确认转诊"按钮

**预期结果：**
- ✅ 显示提示"请选择诊室"
- ✅ 不执行转诊操作

**验证点：**
- [ ] 前端验证生效
- [ ] 无 API 调用
- [ ] 提示信息友好

---

### 2.7 分诊弹窗交互

#### 测试场景 1：弹窗打开与关闭

**操作步骤：**
1. 点击"下一位"打开弹窗
2. 点击遮罩层关闭弹窗
3. 或点击关闭按钮（×）
4. 或点击"取消"按钮

**预期结果：**
- ✅ 弹窗正确打开和关闭
- ✅ 动画流畅
- ✅ 关闭后状态正确重置

**验证点：**
- [ ] 弹窗状态正确切换
- [ ] 遮罩层点击有效
- [ ] 关闭按钮有效
- [ ] 取消按钮有效
- [ ] 动画无卡顿

---

#### 测试场景 2：弹窗显示内容

**前置条件：**
- 分诊弹窗已打开

**验证点：**
- [ ] 患者头像显示（首字母）
- [ ] 患者姓名正确
- [ ] 排队号正确
- [ ] 呼叫次数正确
- [ ] 提示信息显示
- [ ] 转诊选项显示（如有可用诊室）

---

## 三、边界测试

### 3.1 空队列测试

**测试场景：** 队列中无患者

**操作：**
1. 点击"呼叫"或"下一位"按钮

**预期结果：**
- ✅ 显示"暂无候诊患者"提示
- ✅ 不调用 API
- ✅ 按钮状态正常

---

### 3.2 网络错误测试

**测试场景：** 断网状态

**操作：**
1. 断开网络连接
2. 进行任意操作（呼叫、过号、结诊等）

**预期结果：**
- ✅ 显示"网络错误"提示
- ✅ 不改变本地状态
- ✅ 按钮恢复可点击状态

---

### 3.3 快速重复点击测试

**测试场景：** 快速重复点击按钮

**操作：**
1. 快速多次点击"呼叫"按钮
2. 快速多次点击"重呼"按钮

**预期结果：**
- ✅ 只执行一次操作
- ✅ 加载状态防止重复提交
- ✅ 无重复 API 调用

---

### 3.4 并发操作测试

**测试场景：** 同时进行多个操作

**操作：**
1. 在呼叫进行中点击过号
2. 在分诊弹窗打开时点击其他按钮

**预期结果：**
- ✅ 操作按顺序执行
- ✅ 无状态冲突
- ✅ UI 响应正常

---

## 四、响应式测试

### 4.1 桌面端（≥ 768px）

**测试项：**
- [ ] 分诊弹窗居中显示
- [ ] 弹窗宽度为 500px
- [ ] 按钮横向排列
- [ ] 患者信息完整显示

---

### 4.2 移动端（< 768px）

**测试项：**
- [ ] 分诊弹窗底部对齐
- [ ] 弹窗宽度为 100%
- [ ] 按钮纵向排列
- [ ] 患者信息适配显示
- [ ] 触摸操作流畅

---

## 五、性能测试

### 5.1 响应时间

| 操作 | 预期时间 | 测试结果 |
|------|----------|----------|
| 打开分诊弹窗 | < 100ms | [ ] 通过 |
| 关闭分诊弹窗 | < 100ms | [ ] 通过 |
| 呼叫患者 | < 500ms | [ ] 通过 |
| 重呼患者 | < 500ms | [ ] 通过 |
| 过号操作 | < 500ms | [ ] 通过 |
| 结诊操作 | < 500ms | [ ] 通过 |

---

### 5.2 内存泄漏

**测试项：**
- [ ] 弹窗打开关闭多次后内存稳定
- [ ] 切换标签页后内存释放正常
- [ ] 无事件监听器泄漏

---

## 六、UI/UX 测试

### 6.1 动画效果

**测试项：**
- [ ] 弹窗淡入动画流畅（300ms）
- [ ] 弹窗滑动动画流畅
- [ ] 按钮悬停效果正常
- [ ] 加载动画正常旋转

---

### 6.2 颜色主题

**测试项：**
- [ ] 患者头像渐变色正确（紫色渐变）
- [ ] 按钮颜色符合规范
  - 转诊：蓝色 (#409eff)
  - 结诊：绿色 (#67c23a)
  - 取消：灰色 (#909399)
- [ ] 提示信息颜色正确

---

### 6.3 交互反馈

**测试项：**
- [ ] 按钮悬停变色
- [ ] 按钮点击效果
- [ ] 禁用状态显示
- [ ] 加载状态显示
- [ ] 成功/错误提示

---

## 七、集成测试流程

### 7.1 完整就诊流程

**测试步骤：**

1. **启动应用**
   - [ ] 应用正常启动
   - [ ] 自动获取在诊患者
   - [ ] 首次进入标记正确初始化

2. **首次呼叫**
   - [ ] 点击"下一位"直接呼叫
   - [ ] 患者信息正确显示
   - [ ] 状态正确更新

3. **重呼患者**
   - [ ] 点击"重呼"按钮
   - [ ] 呼叫次数 +1
   - [ ] 界面正确更新

4. **呼叫下一位**
   - [ ] 点击"下一位"
   - [ ] 显示分诊弹窗
   - [ ] 患者信息正确

5. **选择结诊**
   - [ ] 点击"完成诊疗"
   - [ ] 确认对话框
   - [ ] 结诊成功
   - [ ] 自动呼叫下一位

6. **验证状态**
   - [ ] 前一位患者进入"结诊"标签
   - [ ] 新患者进入"接诊中"状态
   - [ ] 界面正确更新

---

### 7.2 转诊流程

**测试步骤：**

1. **打开分诊弹窗**
   - [ ] 点击"下一位"
   - [ ] 弹窗显示当前患者信息
   - [ ] 诊室列表加载成功

2. **选择目标诊室**
   - [ ] 下拉框显示诊室列表
   - [ ] 选择一个诊室
   - [ ] 诊室名称正确显示

3. **确认转诊**
   - [ ] 点击"确认转诊"按钮
   - [ ] 转诊成功提示
   - [ ] 弹窗关闭
   - [ ] 患者从列表移除

4. **验证结果**
   - [ ] 患者不在当前列表
   - [ ] 在诊患者清空
   - [ ] 可继续呼叫下一位

---

## 八、问题检查清单

### 8.1 功能问题

- [ ] 所有按钮正常工作
- [ ] 所有弹窗正常打开/关闭
- [ ] API 调用成功
- [ ] 数据正确更新
- [ ] 状态正确流转

### 8.2 兼容性问题

- [ ] Chrome 浏览器正常
- [ ] Edge 浏览器正常
- [ ] Firefox 浏览器正常
- [ ] Safari 浏览器正常（如适用）

### 8.3 用户体验问题

- [ ] 提示信息清晰友好
- [ ] 操作流程符合直觉
- [ ] 错误提示有帮助
- [ ] 加载状态明确
- [ ] 无卡顿或闪烁

---

## 九、测试报告模板

### 测试日期：____/____/______

### 测试人员：_______________

### 测试环境：
- 浏览器：_______________
- 屏幕尺寸：_____________
- 网络状况：_____________

### 测试结果：

| 测试项 | 结果 | 问题描述 | 优先级 |
|--------|------|----------|--------|
| 呼叫患者 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |
| 重呼患者 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |
| 下一位功能 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |
| 过号功能 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |
| 结诊功能 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |
| 分诊弹窗 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |
| 转诊功能 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |
| 响应式布局 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |
| 性能测试 | ☐ 通过 ☐ 失败 | | P1/P2/P3 |

### 总体评价：

☐ 所有功能正常，可以发布
☐ 有小问题，建议修复后发布
☐ 有严重问题，必须修复后发布

### 备注：

___________________________________________________________

___________________________________________________________

___________________________________________________________

---

## 十、已知问题和限制

### 10.1 已知问题

| 问题 | 影响 | 临时方案 | 计划修复 |
|------|------|----------|----------|
| - | - | - | - |

### 10.2 功能限制

| 限制 | 说明 | 影响 |
|------|------|------|
| 无可用诊室 | 如果系统中没有其他诊室，只能结诊 | 中 |
| 网络依赖 | 所有操作需要网络连接 | 高 |

---

## 十一、后续优化建议

### 11.1 短期优化

1. 添加操作确认对话框（避免误操作）
2. 优化错误提示信息
3. 添加操作音效
4. 完善加载状态

### 11.2 中期优化

1. 实现 MQTT 实时同步
2. 集成语音播报
3. 添加快捷键支持
4. 记录操作历史

### 11.3 长期优化

1. 支持批量操作
2. 实现撤销功能
3. 数据统计和分析
4. 智能推荐功能

---

**文档结束**
